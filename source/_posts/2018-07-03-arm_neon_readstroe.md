---
title: ARM Neon 编程(一)：读取与存储
description: Neon 中的 load 与 store 指令
date: 2018-07-03
category: Neon
tags: [ARM, Neon]
---

## 示例

假设当前有 24 bits `RGB` 图像，对该图像要对其中部分通道做一定操作，如交换 `R` 通道和 `B` 通道。由于数据在内存中的排布为 `R`,`G`,`B` 单通道以此交错排布，所以载入寄存器时还要借助一些操作分离三个通道。
Neon 读取指令可以在载入寄存器时就完成分选操作，上面分离三通道的 Neon 指令如下

```asm
VLD3.8 {d0, d1, d2} [r0]
```

这样一条指令就可以将 `RGB` 三个通道分别装入到 `d0`, `d1`, `d2` 中。源地址由 `r0` arm 寄存器指定。

## 读取指令

```asm
VLD3.8 {d0, d1, d2} [r0];
```

上面这行 Neon 指令语义分以下几个部分

- VLD
    指令助记符 `VLS`, `VST` 助记符，表明这是读取指令还是存储指令
- 3
    分选模式，表示相对应元素之间的间隔
- 8
    元素类型，表示访问元素的 bits 数
- {d0, d1, d2}
    Neon 寄存器列表，对列表中的寄存器进行读或写操作。最多可以有 4 个，也有分选模式决定.
- [r0]
    arm 地址寄存器，指定源数据地址，可以再访问后更新。

### 分选模式(interleave pattern)

Neon 指令能够读取，存储并且分选包含有 1 到 4 个相同大小元素的结构，元素种类为 Neon 支持的如 8, 16, 32 bits 类型数据

- VLD1
    无分选模式读取，从内存读取 1 到 4 个寄存器大小数据。通常用于处理非交错数据(non-interleaveing data)
- VLD2
    分选模式为 3，从内存读入 2 到 4 个寄存器大小。奇数位置和偶数位置元素装入不同寄存器中。通常用于分离双通道数据，如左右立体声。
- VLD3
    分选模式为 3，读入 3 个寄存器大小数据并分选通道。通常用于 `RGB` 图像的通道分离。
- VLD4
    分选模式为 4， 读入 4 个寄存器大小数据并分选通道。通常用于分离 `ARGB` 图像的通道分离。

以上这些模式都有对应的存储指令，可以在写入内存前就完成通道的分选。

### 元素类型(element type)

元素类型通常表示为 8 bits, 16 bits, 还是 32 bits. 影响寄存器装入的元素个数和分选步长。

